import{_ as K}from"../chunks/preload-helper-e4860ae8.js";import{S as Z,i as G,s as H,e as T,k as B,t as Q,L as X,c as A,a as j,d as g,m as M,h as Y,M as N,b as E,J as k,g as q,N as R,K as W,O as $,v as ee,P as te}from"../chunks/vendor-87c94948.js";function re(e){let r,h,l,s,a,v,u,_,U,n,w,b,L,C,x,S;return{c(){r=T("script"),l=T("script"),a=B(),v=T("div"),u=T("div"),_=T("input"),U=B(),n=T("img"),b=B(),L=T("span"),C=Q("\uC120\uD0DD\uD558\uAE30"),this.h()},l(c){const m=X('[data-svelte="svelte-1neeb6f"]',document.head);r=A(m,"SCRIPT",{src:!0});var O=j(r);O.forEach(g),l=A(m,"SCRIPT",{src:!0});var P=j(l);P.forEach(g),m.forEach(g),a=M(c),v=A(c,"DIV",{class:!0});var i=j(v);u=A(i,"DIV",{class:!0});var t=j(u);_=A(t,"INPUT",{class:!0,type:!0}),U=M(t),n=A(t,"IMG",{class:!0,src:!0,alt:!0}),b=M(t),L=A(t,"SPAN",{});var o=j(L);C=Y(o,"\uC120\uD0DD\uD558\uAE30"),o.forEach(g),t.forEach(g),i.forEach(g),this.h()},h(){N(r.src,h="https://cdn.jsdelivr.net/npm/web-streams-polyfill@2.0.2/dist/ponyfill.min.js")||E(r,"src",h),N(l.src,s="https://cdn.jsdelivr.net/npm/streamsaver@2.0.3/StreamSaver.min.js")||E(l,"src",s),E(_,"class","hidden"),E(_,"type","file"),E(n,"class","w-14 h-auto py-1"),N(n.src,w="file-text.svg")||E(n,"src",w),E(n,"alt","file_icon"),E(u,"class","rounded border border-gray-300 px-14 py-10 cursor-pointer"),E(v,"class","w-screen h-screen flex items-center justify-center flex-col select-none")},m(c,m){k(document.head,r),k(document.head,l),q(c,a,m),q(c,v,m),k(v,u),k(u,_),e[4](_),k(u,U),k(u,n),k(u,b),k(u,L),k(L,C),x||(S=[R(_,"change",e[5]),R(_,"change",e[3]),R(u,"click",e[2])],x=!0)},p:W,i:W,o:W,d(c){g(r),g(l),c&&g(a),c&&g(v),e[4](null),x=!1,$(S)}}}const D=1024e3,d=1024e4,V=32;function z(e){return new TextDecoder().decode(e)}function ne(e){return new TextEncoder().encode(e)}function le(e){if(e=new Uint8Array(e),e.slice(0,8).reduce((l,s)=>l+s)!=0)return;let r=e[8];if(e.slice(9,16).reduce((l,s)=>l+s)!=0)return;let h=parseInt(z(e.slice(16,24)),16);if(z(e.slice(24,32))=="L3000009")return{blockCount:r,crc:h}}function F(){let e=new Uint8Array(d);for(let r=0;r<=d;r++)e[r]=r%256;return e}function ie(e){let r=F();e=ne(e);let h=!1,l=0,s=0;for(let a=0;a<d;a++){if(h){h=!1,l++;continue}l>=e.length&&(l=0,a+=1),h=!0,r[a]+=e[s++],s>=e.length&&(s=0)}return r}function se(e,r,h){let l;ee(async()=>{l=await K(()=>import("../chunks/StreamSaver-45bc9e71.js").then(function(n){return n.S}),[])});let s,a;function v(){a&&a.click()}async function u(){if(s&&s.length>0){let n=s[0],w=n.size,b=n.name,L=await n.slice(w-V).arrayBuffer(),C=le(L);if(!C){alert("J2J \uD30C\uC77C\uC774 \uC544\uB2D9\uB2C8\uB2E4.");return}console.log(C);let x=prompt("\uBE44\uBC00\uBC88\uD638\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694");if(x==null){alert("\uCDE8\uC18C\uD558\uC168\uC2B5\uB2C8\uB2E4.");return}let S=Math.max(Math.floor(d/(w*100)),1),c;x==""?c=F():c=ie(x);let m;b.endsWith(".j2j")||b.endsWith(".J2J")?m=b.substring(0,b.length-4):m=b+".dec";const P=l.createWriteStream(m,{size:w-V}).getWriter();for(let i=0;i<S;i++){let t=i*d,o=t+d,p=o-t;console.log(t,o);let y=0;for(;p>0;){let J=t+D;J>o&&(J=o);let f=new Uint8Array(await n.slice(t,J).arrayBuffer());for(let I=0;I<f.byteLength;I++)f[I]^=c[y],c[y]^=f[I],y+=1;t+=f.byteLength,p-=f.byteLength,await P.write(f)}}{let i=S*d,t=w-S*d-V,o=t-i;for(console.log(i,t);o>0;){let p=i+D;p>t&&(p=t);let y=new Uint8Array(await n.slice(i,p).arrayBuffer());o-=p-i,i+=y.byteLength,await P.write(y)}}for(let i=0;i<S;i++){let t=w-S*d-V+i*d,o=w-S*d-V+i*d+d,p=o-t;console.log(t,o,p);let y=0;for(;p>0;){let J=t+D;J>o&&(J=o);let f=new Uint8Array(await n.slice(t,J).arrayBuffer());for(let I=0;I<f.byteLength;I++)f[I]^=c[y],c[y]^=f[I],y+=1;t+=f.byteLength,p-=f.byteLength,await P.write(f)}}P.close()}}function _(n){te[n?"unshift":"push"](()=>{a=n,h(1,a)})}function U(){s=this.files,h(0,s)}return[s,a,v,u,_,U]}class oe extends Z{constructor(r){super();G(this,r,se,re,H,{})}}export{oe as default};
